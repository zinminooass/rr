<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Snack Corner</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<link href="https://fonts.googleapis.com/css2?family=Caveat:wght@500;700&family=Roboto+Mono&family=Pacifico&display=swap" rel="stylesheet">
<style>
*{margin:0;padding:0;box-sizing:border-box;}
body{font-family:'Roboto Mono', monospace;background:linear-gradient(135deg,#fff6e5,#ffe0b2);color:#1e1e1e;min-height:100vh;}
.container{max-width:1200px;margin:auto;padding:1rem;}
#menu,#cart,#admin{display:none;}
.title{font-family:'Pacifico',cursive;font-size:6rem;color:#d84315;text-align:center;margin-bottom:1rem;}
button{cursor:pointer;transition:0.3s;}
button:active{transform:scale(0.95);}
.btn{padding:.6rem 1.2rem;border:none;border-radius:12px;font-weight:600;}
.primary{background:#d84315;color:#fff;}
.danger{background:#e53935;color:#fff;}
.top-icons{display:flex;justify-content:space-between;align-items:center;margin-bottom:1rem;}
.top-left-icons{display:flex;gap:0.8rem;}
.contact-icon{font-size:1.5rem;color:#fff;background:#d84315;border-radius:50%;width:50px;height:50px;display:flex;justify-content:center;align-items:center;box-shadow:0 4px 8px rgba(0,0,0,0.1);transition:0.25s;text-decoration:none;}
.contact-icon:hover{transform:scale(1.1);background:#b71c1c;}
.top-right-icons{display:flex;gap:0.8rem;}
.cart-icon{font-size:1.5rem;color:#fff;background:#d84315;border-radius:50%;width:50px;height:50px;display:flex;justify-content:center;align-items:center;box-shadow:0 4px 8px rgba(0,0,0,0.1);transition:0.25s;}
.cart-icon:hover{transform:scale(1.1);background:#b71c1c;}
.cart-count{position:absolute;top:-6px;right:-10px;background:#e53935;color:#fff;font-size:12px;padding:2px 6px;border-radius:50%;}
.food-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:1.5rem;}
.food-card {
    background: #ffffff;
    border-radius: 28px;
    overflow: hidden;
    display: flex;
    flex-direction: column;
    padding: 12px; 
    transition: all 0.5s cubic-bezier(0.165, 0.84, 0.44, 1);
    box-shadow: 
        0 4px 6px rgba(0,0,0,0.02),
        0 10px 20px rgba(216, 67, 21, 0.05);
    border: 1px solid rgba(216, 67, 21, 0.1);
    position: relative;
}
.food-card img {
    width: 100%;
    height: 180px;
    object-fit: cover;
    border-radius: 20px; 
    background: #f8f8f8;
    transition: all 0.5s ease;
    filter: saturate(1.1);
}
.food-card:hover {
    transform: translateY(-10px);
    background: #ffffff;
    box-shadow: 
        0 20px 40px rgba(216, 67, 21, 0.12),
        0 1px 3px rgba(0,0,0,0.05);
    border-color: #d84315;
}
.food-card:hover img {
    transform: scale(1.03);
    border-radius: 18px; 
}

.food-info {
    padding: 15px 10px 5px 10px;
    display: flex;
    flex-direction: column;
    gap: 6px;
    align-items: center;
}

.food-info b {
    font-size: 1.1rem;
    color: #333;
    letter-spacing: -0.5px;
}
.price {
    font-family: 'Fiancier', cursive; 
    color: #d84315;
    font-size: 1.3rem;
    margin-bottom: 5px;
}
.food-card .btn.primary {
    width: 100%;
    border-radius: 15px;
    letter-spacing: 0.5px;
    box-shadow: 0 4px 12px rgba(216, 67, 21, 0.2);
}

.price{color:#d84315;font-weight:700;font-size:1.2rem;}
.in{color:#2e7d32;font-weight:600;}
.out{color:#c62828;font-weight:600;}
input{width:100%;padding:.7rem;margin:.3rem 0;border-radius:10px;border:1px solid #ddd;font-family:'Roboto Mono', monospace;}
#adminContent{margin-top:1.5rem;border-top:2px solid #eee;padding-top:1rem;max-height:70vh;overflow-y:auto;}
.stock-btn{width:100%;padding:.5rem;border:none;border-radius:10px;color:#fff;font-weight:600;margin-top:4px;}
.stock-btn.in{background:#2e7d32;}
.menu-title {
    text-align: center;
    font-family: 'Pacifico', cursive;
    font-size: 2.8rem;
    color: #d84315;
    margin: 2rem 0;

}
.flying-item {
    position: fixed;
    z-index: 9999;
    width: 35px;
    height: 35px;
    background: #d84315;
    border-radius: 50%;
    display: flex;
    justify-content: center;
    align-items: center;
    color: white;
    pointer-events: none;

    transition: all 1.5s cubic-bezier(0.19, 1, 0.22, 1);
    box-shadow: 0 4px 10px rgba(0,0,0,0.2);
}
.cart-icon {
    font-size: 1.5rem;
    color: #fff !important;
    background: #d84315 !important; 
    border-radius: 50%;
    width: 50px;
    height: 50px;
    display: flex;
    justify-content: center;
    align-items: center;
    box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    transition: transform 0.25s;
    text-decoration: none;
    border: none;
}


.cart-icon:hover {
    background: #b71c1c !important; 
    transform: scale(1.1);
}


@keyframes cartPop {
    0% { transform: scale(1); }
    30% { transform: scale(1.4); }
    50% { transform: scale(0.9); }
    100% { transform: scale(1); }
}

.cart-bounce { 
    animation: cartPop 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275) !important;
}
input, textarea {
    width: 100%;
    padding: .7rem;
    margin: .3rem 0;
    border-radius: 10px;
    border: 1px solid #ddd;
    font-family: 'Roboto Mono', monospace;
    outline: none;
}
input:focus, textarea:focus {
    border-color: #d84315;
}
.stock-btn.out{background:#c62828;}

.cart-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 1rem 0.5rem;
    
    border-bottom: 4px solid #d84315; 
    margin-bottom: 8px;
    border-radius: 4px; 
}


.cart-item:last-child {
    border-bottom: none;
}
.running-text {
    background: rgba(255, 255, 255, 0.4); 
    backdrop-filter: blur(12px); 
    -webkit-backdrop-filter: blur(12px);
    
    
    border-radius: 50px; 
    
   
    border: 1px solid rgba(216, 67, 21, 0.2);
    margin: 0 1rem 1.5rem 1rem; 
    
    color: #d84315;
    padding: 12px 0;
    overflow: hidden;
    white-space: nowrap;
    font-family: 'Pacifico', cursive; 
    font-size: 1.6rem; 
    box-shadow: 0 4px 15px rgba(216, 67, 21, 0.08);
    display: flex;
    align-items: center;
}

.running-text span {
    display: inline-block;
    padding-left: 100%;
    animation: scrollText 20s linear infinite; 
    text-shadow: 1px 1px 2px rgba(0,0,0,0.03);
}

@keyframes scrollText {
    0% { transform: translateX(0); }
    100% { transform: translateX(-100%); }
}
@keyframes scrollText{0%{transform:translateX(0%);}100%{transform:translateX(-100%);}}
@media(max-width:768px){.title{font-size:2.2rem;}.menu-title{font-size:2.2rem;}.contact-icon,.cart-icon{width:45px;height:45px;font-size:1.3rem;}}
</style>
</head>
<body>

<div class="container">
    <div id="welcome" style="display:block;text-align:center;margin-top:20vh;">
        <video class="welcome-vid" autoplay loop muted playsinline>
          <source src="animation1.mp4" type="video/mp4">
           
        </video>
        <div class="title">Welcome to Snack Corner</div>
        <p style="margin-bottom:2rem;">Your favorite snacks delivered!!</p>
        <button class="btn primary" onclick="show('menu')">Explore Menu</button>
    </div>

    <div id="menu">
        <div class="top-icons">
            <div class="top-left-icons">
                <a href="tel:09779525371" class="contact-icon" title="Call / KPay"><i class="fas fa-phone"></i></a>
                <a href="https://t.me/Yee5SW" target="_blank" class="contact-icon" title="Message on Telegram"><i class="fab fa-telegram-plane"></i></a>
            </div>
            <div class="menu-title">Our Items</div>

            <div class="top-right-icons">
                <div style="position:relative;">
                    <i class="fas fa-shopping-cart cart-icon" onclick="show('cart')"></i>
                    <span class="cart-count" id="cartCount">0</span>
                </div>
                <i class="fas fa-user-cog cart-icon" onclick="show('admin')"></i>
            </div>
        </div>
        <div id="runningText" class="running-text" style="display:none"><span id="runningTextContent"></span></div>
        <div class="food-grid" id="foodList">Loading items...</div>
    </div>

    <div id="cart">
       <div class="top-icons">
         <i class="fas fa-arrow-left cart-icon" onclick="show('menu')"></i>
       </div>
    
       <h3 style="display: flex; align-items: center; gap: 10px; margin-bottom: 1rem;">
         <i class="fas fa-shopping-basket" style="color: #d84315;"></i> Your Order
       </h3>

       <div id="cartItems"></div>
          <h4 style="margin:1rem 0; border-top: 1px solid #ddd; padding-top: 10px;">
            Total - <span id="totalPrice">0.00  Kyats</span>
          </h4>
    
       <div style="position: relative; margin-bottom: 8px;">
          <i class="fas fa-user" style="position: absolute; left: 12px; top: 15px; color: #888;"></i>
          <input id="name" placeholder="Full Name" style="padding-left: 35px;">
       </div>

       <div style="position: relative; margin-bottom: 8px;">
          <i class="fas fa-hotel" style="position: absolute; left: 12px; top: 15px; color: #888;"></i>
          <input id="hostel" placeholder="Hostel/Room No." style="padding-left: 35px;">
       </div>

       <div style="position: relative; margin-bottom: 8px;">
          <i class="fas fa-phone-alt" style="position: absolute; left: 12px; top: 15px; color: #888;"></i>
          <input id="phone" placeholder="Phone Number" style="padding-left: 35px;">
       </div>
    
       <div style="position: relative; margin-bottom: 8px;">
          <i class="fas fa-comment-dots" style="position: absolute; left: 12px; top: 15px; color: #888;"></i>
          <textarea id="orderMsg" placeholder="Any messages for us???" 
            style="width:100%; padding: .7rem .7rem .7rem 35px; margin:.3rem 0; border-radius:10px; border:1px solid #ddd; font-family:inherit; min-height: 80px; resize: none;"></textarea>
       </div>

       <button class="btn primary" style="width:100%; margin-top:1rem; display: flex; justify-content: center; align-items: center; gap: 10px;" onclick="placeOrder()">
         <i class="fas fa-paper-plane"></i> Confirm Order
       </button>
    
        <p style="text-align:center; margin-top:15px; color:#d84315; font-weight:bold; font-size: 0.85rem;">
          <i class="fas fa-info-circle"></i> Orders can be paid with Cash or KPay(09-779525371)
        </p>
    </div>

    <div id="admin">
        <div class="top-icons"><i class="fas fa-arrow-left cart-icon" onclick="show('menu')"></i></div>
        <h3>Admin Panel</h3>
        <div id="loginArea">
            <input id="adminPass" type="password" placeholder="Enter Admin Password">
            <button class="btn primary" onclick="login()">Login</button>
        </div>
        <div id="adminContent" style="display:none">
            <h4>Add New Product</h4>
            <input id="newName" placeholder="Product Name">
            <input id="newPrice" type="number" placeholder="Price">
            <input id="newImg" type="file" accept="image/*">
            <button class="btn primary" onclick="addFood()" id="addBtn">Upload & Add Product</button>

            <h4 style="margin-top:2rem">Manage Inventory</h4>
            <div class="food-grid" id="adminFood"></div>

            <h4 style="margin-top:2rem">Running Text</h4>
            <input id="newText" placeholder="Add running text">
            <button class="btn primary" onclick="addRunningText()">Add</button>
            <div id="runningTextAdmin"></div>
        </div>
    </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-app.js";

import { getFirestore, collection, onSnapshot, addDoc, updateDoc, doc, serverTimestamp, deleteDoc, getDoc } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-firestore.js";
const firebaseConfig = {
  apiKey: "AIzaSyAcC--9gqyvSKgNJgXn8PxhUZkNANkgEFY",
  authDomain: "shwe-yi-win23.firebaseapp.com",
  projectId: "shwe-yi-win23",
  storageBucket: "shwe-yi-win23.firebasestorage.app",
  appId: "1:358130981782:web:6afb45eb96eb41bb7"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const foodCol = collection(db,'foods');
const runningTextCol = collection(db,'runningText');


const ADMIN_PASSWORD = "555555";
const IMGBB_API_KEY = "7ecf9bb152629974bc5018633b8de663";
const TELEGRAM_BOT_TOKEN = "8200977847:AAHYUxSQdfk_rcZgLKgJcqtoD6NK6o8T4OM";
const TELEGRAM_CHAT_ID = "7905877302";

let cart=[];

async function loadWelcomeGif() {
    try {
        const docRef = doc(db, "settings", "welcomeGif");
        const docSnap = await getDoc(docRef);
        if (docSnap.exists()) {
            const gifElement = document.getElementById('welcomeGif');
            gifElement.src = docSnap.data().url;
            gifElement.style.display = 'block';
        }
    } catch (e) { console.log("GIF load error:", e); }
}
loadWelcomeGif();

window.show=(id)=>{document.querySelectorAll('#welcome,#menu,#cart,#admin').forEach(el=>el.style.display='none');document.getElementById(id).style.display='block'; if(id==='menu') renderMenu();};

function renderMenu(){
    const container = document.getElementById('foodList'); 
    container.innerHTML = 'Loading items...';
    
    onSnapshot(foodCol, snap => {
        container.innerHTML = '';
        let items = [];
        
        snap.forEach(d => {
            const f = d.data(); 
            f.id = d.id; 
            items.push(f);
        });

        
        items.sort((a, b) => {
            
            if (a.inStock !== b.inStock) return b.inStock - a.inStock;
            
            return (a.sortOrder || 99) - (b.sortOrder || 99);
        });

        items.forEach(f => {
            const card = document.createElement('div');
            card.className = 'food-card';
            card.innerHTML = `
                <img src="${f.img || 'https://via.placeholder.com/300x180'}">
                <div class="food-info">
                    <b>${f.name}</b>
                    <div class="price">${Number(f.price)} Kyats</div>
                    <div class="${f.inStock ? 'in' : 'out'}">${f.inStock ? 'In Stock' : 'Out of Stock'}</div>
                    
                    ${f.inStock ? `<button class="btn primary" onclick="addToCart('${f.id}','${f.name}',${f.price}, event)">Add to Cart</button>` : ''}
                </div>`;
            container.appendChild(card);
        });
    });

    const menuText = document.getElementById('runningTextContent');
    onSnapshot(runningTextCol, snap => {
        let txt = ''; 
        snap.forEach(d => { txt += d.data().text + ' ‚Ä¢ '; });
        menuText.innerHTML = txt; 
        document.getElementById('runningText').style.display = txt ? 'block' : 'none';
    });
}
window.addToCart = (id, name, price, event) => {
    cart.push({id, name, price});
    updateCartUI();

    const cartIcon = document.querySelector('.fa-shopping-cart');
    const target = cartIcon.getBoundingClientRect();
    
    const flyer = document.createElement('div');
    flyer.className = 'flying-item';
    flyer.innerHTML = '<i class="fas fa-plus"></i>';
    flyer.style.left = event.clientX + 'px';
    flyer.style.top = event.clientY + 'px';
    document.body.appendChild(flyer);

    setTimeout(() => {
        flyer.style.left = (target.left + 10) + 'px';
        flyer.style.top = (target.top + 10) + 'px';
        flyer.style.transform = 'scale(0.1)'; 
        flyer.style.opacity = '0';
    }, 50);

    setTimeout(() => {
        flyer.remove();
        
        
        const cartWrapper = document.querySelector('.fa-shopping-cart').parentElement;
        
        
        cartWrapper.classList.add('cart-bounce');
        
       
        setTimeout(() => {
            cartWrapper.classList.remove('cart-bounce');
        }, 600);
    }, 1200);
};

function updateCartUI() {
    const list = document.getElementById('cartItems');
    let total = 0;
    list.innerHTML = '';

    
    const groupedCart = {};
    cart.forEach((item) => {
        if (!groupedCart[item.name]) {
            groupedCart[item.name] = { price: item.price, qty: 0 };
        }
        groupedCart[item.name].qty++;
    });

   
    Object.entries(groupedCart).forEach(([name, data]) => {
        const itemTotal = data.qty * data.price;
        total += itemTotal;

        const itemRow = document.createElement('div');
        itemRow.className = 'cart-item';
        itemRow.innerHTML = `
            <div style="flex: 1;">
                <b style="color: #d84315;">${data.qty}</b> x <span>${name}</span>
                <div style="font-size: 0.8rem; color: #888;">${data.qty} * ${data.price} = ${itemTotal} Kyats</div>
            </div>
            <button class="btn danger" onclick="removeFromCartByName('${name}')" style="padding:5px 10px; border-radius: 8px;">
                <i class="fas fa-trash"></i>
            </button>
        `;
        list.appendChild(itemRow);
    });

    document.getElementById('totalPrice').textContent = total.toFixed(2) + " Kyats";
    document.getElementById('cartCount').textContent = cart.length;
}


window.removeFromCartByName = (name) => {
    cart = cart.filter(item => item.name !== name);
    updateCartUI();
};
window.removeFromCart=(idx)=>{cart.splice(idx,1); updateCartUI();};

window.login=()=>{const pass=document.getElementById('adminPass').value; if(pass===ADMIN_PASSWORD){document.getElementById('loginArea').style.display='none'; document.getElementById('adminContent').style.display='block'; renderAdmin(); renderRunningText();} else alert("Incorrect Password");};

async function uploadToImgBB(file){const form=new FormData(); form.append('image',file); const res=await fetch(`https://api.imgbb.com/1/upload?key=${IMGBB_API_KEY}`,{method:'POST',body:form}); const data=await res.json(); if(data.success) return data.data.url; throw new Error("Upload failed");}

window.addFood=async ()=>{
    const name=document.getElementById('newName').value;
    const price=document.getElementById('newPrice').value;
    const file=document.getElementById('newImg').files[0];
    const msg = document.getElementById('orderMsg').value;
    
    if(!name||!price) return alert("Name and Price required");
    try{
        let imgUrl=''; if(file) imgUrl=await uploadToImgBB(file);
        await addDoc(foodCol,{name,price:Number(price),img:imgUrl,inStock:true,createdAt:serverTimestamp()});
        document.getElementById('newName').value=''; document.getElementById('newPrice').value=''; document.getElementById('newImg').value='';
        alert("Added successfully!");
    } catch(e){alert("Error adding item")}
};

function renderAdmin(){
    
    const container=document.getElementById('adminFood');
    onSnapshot(foodCol,snap=>{
        container.innerHTML=''; let inStock=[], outStock=[]; snap.forEach(d=>{const f=d.data(); f.id=d.id; if(f.inStock) inStock.push(f); else outStock.push(f);}); const items=[...inStock,...outStock];
        items.forEach(f=>{
            const card=document.createElement('div');
            card.className='food-card';
            card.innerHTML=`<img src="${f.img||'https://via.placeholder.com/300x180'}"><div class="food-info"><input id="n-${f.id}" value="${f.name}"><input id="p-${f.id}" type="number" value="${f.price}"><label style="font-size:12px;">Change Photo:</label><input type="file" id="file-${f.id}" accept="image/*"><button class="stock-btn ${f.inStock?'in':'out'}" onclick="toggleStock('${f.id}',${f.inStock})">${f.inStock?'Mark Out of Stock':'Mark In Stock'}</button><button class="btn primary" onclick="saveItem('${f.id}')">Save Changes</button><button class="btn danger" style="width:100%;margin-top:5px;" onclick="deleteFoodItem('${f.id}')">Delete Product</button></div>`;
            container.appendChild(card);
        });
    });
}


window.deleteFoodItem=async (id)=>{
    if(confirm("Are you sure you want to delete this product?")){
        try {
            await deleteDoc(doc(db,'foods',id));
            alert("Product deleted successfully!");
        } catch(e) {
            alert("Error deleting product");
        }
    }
}

window.saveItem=async (id)=>{const name=document.getElementById(`n-${id}`).value; const price=document.getElementById(`p-${id}`).value; const file=document.getElementById(`file-${id}`).files[0]; try{let updateData={name,price:Number(price)}; if(file) updateData.img=await uploadToImgBB(file); await updateDoc(doc(db,'foods',id),updateData); alert("Updated!");} catch(e){alert("Update failed")}};
window.toggleStock=async (id,currentStatus)=>{await updateDoc(doc(db,'foods',id),{inStock:!currentStatus});}

window.addRunningText=async ()=>{const txt=document.getElementById('newText').value.trim(); if(!txt) return alert("Enter text"); await addDoc(runningTextCol,{text:txt,createdAt:serverTimestamp()}); document.getElementById('newText').value=''; renderRunningText();}
function renderRunningText(){const container=document.getElementById('runningTextAdmin'); onSnapshot(runningTextCol,snap=>{container.innerHTML=''; snap.forEach(d=>{const t=d.data(); const id=d.id; const div=document.createElement('div'); div.style.display='flex'; div.style.alignItems='center'; div.style.margin='3px 0'; div.innerHTML=`<span style="flex:1">${t.text}</span> <button class="btn danger" onclick="deleteRunningText('${id}')">X</button>`; container.appendChild(div);});});}
window.deleteRunningText=async (id)=>{await deleteDoc(doc(db,'runningText',id)); renderRunningText();}

window.placeOrder = async () => {
    const name = document.getElementById('name').value; 
    const hostel = document.getElementById('hostel').value; 
    const phone = document.getElementById('phone').value;
    
    
    const msg = document.getElementById('orderMsg').value;

    if(cart.length === 0 || !name || !phone) return alert("Enter name, phone and add items");

    
    const summary = {};
    cart.forEach(i => {
        if(!summary[i.name]) summary[i.name] = {qty: 0, price: i.price};
        summary[i.name].qty++;
    });

    let itemsText = Object.entries(summary).map(([n, d]) => {
        return `‚Ä¢ ${n}: ${d.qty} x ${d.price} = ${d.qty * d.price} Kyats`;
    }).join('\n');

    let total = cart.reduce((a, b) => a + b.price, 0);

    
    let text = `üì¶ *New Order*\n\n` +
               `üë§ Name: ${name}\n` +
               `üè† Hostel: ${hostel}\n` +
               `üìû Phone: ${phone}\n` +
               `üí¨ Msg: ${msg || 'None'}\n\n` +
               `üõí *Items:*\n${itemsText}\n\n` +
               `üí∞ *Total: ${total} Kyats*`;

    try { 
        await fetch(`https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendMessage`, {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({
                chat_id: TELEGRAM_CHAT_ID, 
                text: text, 
                parse_mode: 'Markdown' 
            })
        }); 
        alert("Order sent!"); 
        cart = []; 
        updateCartUI(); 
        document.getElementById('orderMsg').value = '';
        show('menu');
    } catch(e) { 
        alert("Telegram error. Check connection."); 
    }
};
</script>
</body>
</html>